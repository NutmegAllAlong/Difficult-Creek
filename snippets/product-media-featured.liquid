<!-- product-media.liquid -->
{%- liquid
    assign lazy = false

    case media_style
    when 'media-bottom' 
       assign layout_style = ' photos-thumb-bottom '
    when 'media-left' 
        assign layout_style = 'photos-thumb-left d-flex '
    when 'media-right' 
        assign layout_style = ' photos-thumb-right d-flex '
    when 'media-nothumb' 
        assign layout_style = ' photos-nothumb '
    when 'media-list' 
        assign layout_style = ' photos-thumb-list '
    when 'media-grid' 
        assign layout_style = ' photos-thumb-grid '
    when 'media-collage-1' 
        assign layout_style = ' photos-thumb-collage-1 '
    when 'media-collage-2' 
        assign layout_style = ' photos-thumb-collage-2 '
    endcase 

    assign layout_mobile = ''
    if  media_style == 'media-list' or  media_style == 'media-grid' or  media_style == 'media-collage-1' or  media_style == 'media-collage-2'
        assign layout_mobile = ' d-md-none '
    elsif media_style == 'media-nothumb'
        assign layout_mobile = ' hide '
    endif
    -%}
    {% if media_style == 'media-bottom' %}

      <style>
      .product-single__thumbnails {
        opacity: 1 !important;
      }  
      .product-single__thumbnails--static {
        display: flex !important;
        flex-wrap: wrap !important;
        gap: 8px !important;
      }

      .product-single__thumbnail-item {
        width: 80px !important;
        height: 80px !important;
        flex-shrink: 0 !important;
      }

      .product-single__thumbnail-item .image-wrap {
        width: 100% !important;
        height: 100% !important;
      }

      .product-single__thumbnail-item img {
        width: 100% !important;
        height: 100% !important;
        object-fit: cover !important;
      }
      </style>


      <style>
    /* Hide all large gallery images except the featured one */
      .photos-thumb-bottom .my-gallery .photo-image:not(.slick-current) {
          display: none !important;
        }

    /* Ensure featured image displays properly */
      .photos-thumb-bottom .my-gallery .photo-image.slick-current {
          display: block !important;
          margin-bottom: 1.5rem;
        }

      /* Ensure thumbnails display in a row */
      .photos-thumb-bottom .product-single__thumbnails {
          display: flex !important;
          flex-wrap: wrap !important;
          gap: 8px !important;
        }
      </style>
      {% endif %}

        <style>
        .photos-thumb-left .photos__item--main{
            position: relative;
            flex: 1 1 auto;
        }
        .photos-thumb-left .photos__item--thumbs{
            flex: 0 0 80px;
            max-width: 80px;
            order: -1;
            margin-right: 15px;
        }
        .photos-thumb-left .product-single__thumbnails{
            margin: -8px 0;
        }
        .photos-thumb-left .product-single__thumbnails .product-single__thumbnail-item{
            padding: 8px 2px;
        }
        .photos-thumb-right .photos__item--main{
            position: relative;
            flex: 1 1 auto;
        }
        .photos-thumb-right .photos__item--thumbs{
            flex: 0 0 80px;
            max-width: 80px;
            order: 1;
            margin-left: 15px;
        }
        .photos-thumb-right .product-single__thumbnails{
            margin: -8px 0;
        }
        .photos-thumb-right .product-single__thumbnails .product-single__thumbnail-item{
            padding: 8px 2px;
        }
        @media(min-width:768px){
          .photos-thumb-grid,.photos-thumb-collage-1,.photos-thumb-collage-2, .photos-thumb-list  {
            --g-gutter:16px;
            --g-hgutter:8px;
          }
          .photos-thumb-bottom .product-single__photo{
            margin:0 0 24px 0;
          }
            .product-single__photo{
                margin:0 0 var(--g-gutter) 0;
                }
                .photos-thumb-grid .my-gallery{
                display: -ms-flexbox;
                display: flex;
                -ms-flex-wrap: wrap;
                flex-wrap: wrap;
                margin-right: calc(0px - var(--g-hgutter));
                margin-left: calc(0px - var(--g-hgutter));
            }
            .photos-thumb-grid .product-single__photo{
                padding-left: var(--g-hgutter);
                padding-right: var(--g-hgutter);
                margin:0 0 var(--g-gutter) 0;
                flex: 0 0 50%;
                max-width: 50%;
            }
            .photos-thumb-collage-1 .my-gallery{
                display: -ms-flexbox;
                display: flex;
                -ms-flex-wrap: wrap;
                flex-wrap: wrap;
                margin-right: calc(0px - var(--g-hgutter));
                margin-left: calc(0px - var(--g-hgutter));
            }
            .photos-thumb-collage-1 .product-single__photo{
                padding-left: var(--g-hgutter);
                padding-right: var(--g-hgutter);
                margin:0 0 var(--g-gutter) 0;
                flex: 0 0 50%;
                max-width: 50%;
            }
            .photos-thumb-collage-1 .product-single__photo:nth-child(1){
                flex: 0 0 100%;
                max-width: 100%;
            }
            .photos-thumb-collage-2 .my-gallery{
                display: -ms-flexbox;
                display: flex;
                -ms-flex-wrap: wrap;
                flex-wrap: wrap;
                margin-right: calc(0px - var(--g-hgutter));
                margin-left: calc(0px - var(--g-hgutter));
            }
            .photos-thumb-collage-2 .product-single__photo{
                padding-left: var(--g-hgutter);
                padding-right: var(--g-hgutter);
                margin:0 0 var(--g-gutter) 0;
                flex: 0 0 50%;
                max-width: 50%;
            }
            .photos-thumb-collage-2 .product-single__photo:nth-child(3n+1){
                flex: 0 0 100%;
                max-width: 100%;
            }
        }
    </style>
<div class="photos {{ layout_style }}">
  <div class="photos__item photos__item--main" data-aos="fade">
    <div class="my-gallery gallery-wrap{{ unique_id }} mb-0" itemscope itemtype="http://schema.org/ImageGallery">
        
    {%- assign non_variant_image_count = 0 -%}
      {%- for media in product.media -%}
        {%- assign is_variant_image = false -%}
        {%- for variant in product.variants -%}
          {%- if variant.image.src == media.src -%}
            {%- assign is_variant_image = true -%}
            {%- break -%}
          {%- endif -%}
        {%- endfor -%}
  
  {%- if is_variant_image -%}
    {%- continue -%}
  {%- endif -%}
{% assign image = media %}

        {% case media.media_type %}
        {% when 'image' %}
            <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject" 
              class="photo-image {% if image == featured_image %}  slick-current {% endif %} product-single__photo product__photo-container product__photo-container-{{ unique_id }} "
                id="ProductPhoto{{ unique_id }}"
                data-image-id="{{ image.id }}">
                <a href="{{ image | image_url: width: 1400 }}" itemprop="contentUrl" data-size="1400x1400"
                class="product__photo-wrapper product__photo-wrapper-{{ unique_id }} {{ image_size }} "
                style="padding-top:{{ 1 | divided_by: image.aspect_ratio | times: 100 }}%;">
                {% assign img_url = image | image_url: width: 1 | replace: 'width=1', 'width={width}' %}
                <img itemprop="thumbnail" class="lazyload {% unless image == featured_image %} lazypreload{% endunless %}"
                    src="{{ image | image_url: width: 1200 }}"
                    data-src="{{ img_url }}"
                    data-widths="[180, 240, 360, 480, 720, 960, 1080, 1296, 1512, 1728, 2048]"
                    data-aspectratio="{{ image.aspect_ratio }}"
                    data-sizes="auto"
                    alt="{{ image.alt | escape }}"
                    width="{{ image.width }}"
                    height="{{ image.height }}"
                    {% if lazy == true %} loading="lazy" {% endif %}>
              </a>
            </figure>
        {% when 'video' %}

              <div  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject" class="product-single__photo product-single__video product__photo-container product__photo-container-{{ unique_id }} " 
                id="ProductPhoto{{ unique_id }}"
                data-image-id="{{ image.id }}"
                data-videoid="{{ image.id }}">
                <deferred-media class="deferred-media media global-media-settings global-media-settings--no-shadow {{ image_size }}" style="padding-top: {{ 1 | divided_by: media.aspect_ratio | times: 100 }}%" data-media-id="{{ media.id }}">
                  <button id="Deferred-Poster-Modal-{{ media.id }}" class="deferred-media__poster" type="button">
                    <span class="deferred-media__poster-button motion-reduce">
                        {%- render 'icon-play' -%}
                    </span>
                    <img
                      srcset="{% if media.preview_image.width >= 288 %}{{ media.preview_image | image_url: width: 288 }} 288w,{% endif %}
                              {% if media.preview_image.width >= 700 %}{{ media.preview_image | image_url: width: 700 }} 576w,{% endif %}
                              {% if media.preview_image.width >= 550 %}{{ media.preview_image | image_url: width: 550 }} 550w,{% endif %}
                              {% if media.preview_image.width >= 1100 %}{{ media.preview_image | image_url: width: 1100 }} 1100w,{% endif %}
                              {{ media.preview_image | image_url }} {{ media.preview_image.width }}w"
                      src="{{ media | image_url: width: 700, height: 700 }}"
                      sizes="(min-width: 1200px) calc((1200px - 10rem) / 2), (min-width: 750px) calc((100vw - 11.5rem) / 2), calc(100vw - 4rem)"
                      loading="lazy"
                      width="700"
                      height="{{ 700 | divided_by: media.preview_image.aspect_ratio }}"
                      alt="{{ media.preview_image.alt | escape }}"
                    >
                  </button>
                  <template>
                    {{ media | media_tag: image_size: "2048x", autoplay: true, loop: loop, controls: true, preload: "none" }}
                  </template>
                </deferred-media>
              </div> 
        {% when 'external_video' %}
              <div  class="product-single__photo product-single__video product__photo-container product__photo-container-{{ unique_id }} " 
                id="ProductPhoto{{ unique_id }}"
                data-image-id="{{ image.id }}"
                data-videoid="{{ image.id }}">
                  <deferred-media class="deferred-media media global-media-settings global-media-settings--no-shadow {{ image_size }}" style="padding-top: {{ 1 | divided_by: media.aspect_ratio | times: 100 }}%" data-media-id="{{ media.id }}">
                    <button id="Deferred-Poster-Modal-{{ media.id }}" class="deferred-media__poster" type="button">
                      <span class="deferred-media__poster-button motion-reduce">
                          {%- render 'icon-play' -%}
                      </span>
                      <img
                        srcset="{% if media.preview_image.width >= 288 %}{{ media.preview_image | image_url: width: 288 }} 288w,{% endif %}
                                {% if media.preview_image.width >= 576 %}{{ media.preview_image | image_url: width: 576 }} 576w,{% endif %}
                                {% if media.preview_image.width >= 550 %}{{ media.preview_image | image_url: width: 550 }} 550w,{% endif %}
                                {% if media.preview_image.width >= 1100 %}{{ media.preview_image | image_url: width: 1100 }} 1100w,{% endif %}
                                {{ media.preview_image | image_url }} {{ media.preview_image.width }}w"
                        src="{{ media | image_url: width: 700, height: 700 }}"
                        sizes="(min-width: 1200px) calc((1200px - 10rem) / 2), (min-width: 750px) calc((100vw - 11.5rem) / 2), calc(100vw - 4rem)"
                        loading="lazy"
                        width="700"
                        height="{{ 700 | divided_by: media.preview_image.aspect_ratio }}"
                        alt="{{ media.preview_image.alt | escape }}"
                      >
                    </button>
                    <template>
                        {%- assign video_class = 'js-' | append: media.host -%}
                        {%- if media.host == 'youtube' -%}
                          {{ media | external_video_url: autoplay: true, loop: loop, playlist: media.external_id | external_video_tag: class: video_class, loading: "lazy" }}
                        {%- else -%}
                          {{ media | external_video_url: autoplay: true, loop: loop | external_video_tag: class: video_class, loading: "lazy" }}
                        {%- endif -%}
                    </template>
                  </deferred-media>
                </div>
        {% when 'model' %}
              <div  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject" class="product-single__photo product-single__video product__photo-container product__photo-container-{{ unique_id }} " 
                id="ProductPhoto{{ unique_id }}"
                data-image-id="{{ image.id }}"
                data-videoid="{{ image.id }}">
                  <div class="product-media-modal__model" data-media-id="{{ media.id }}">
                    <product-model class="deferred-media media media--transparent global-media-settings global-media-settings--no-shadow {{ image_size }}" style="padding-top: 100%;">
                      <button id="Deferred-Poster-Modal-{{ media.id }}" class="deferred-media__poster" type="button">
                        <span class="deferred-media__poster-button motion-reduce">
                          {%- render 'icon-3d-model' -%}
                        </span>
                        <img
                          srcset="{% if media.preview_image.width >= 288 %}{{ media.preview_image | image_url: width: 288 }} 288w,{% endif %}
                                  {% if media.preview_image.width >= 576 %}{{ media.preview_image | image_url: width: 576 }} 576w,{% endif %}
                                  {% if media.preview_image.width >= 550 %}{{ media.preview_image | image_url: width: 550 }} 550w,{% endif %}
                                  {% if media.preview_image.width >= 1100 %}{{ media.preview_image | image_url: width: 1100 }} 1100w,{% endif %}
                                  {{ media.preview_image | image_url }} {{ media.preview_image.width }}w"
                          src="{{ media | image_url: width: 700, height: 700 }}"
                          sizes="(min-width: 1200px) calc((1200px - 10rem) / 2), (min-width: 750px) calc((100vw - 11.5rem) / 2), calc(100vw - 4rem)"
                          loading="lazy"
                          width="700"
                          height="{{ 700 | divided_by: media.preview_image.aspect_ratio }}"
                          alt="{{ media.preview_image.alt | escape }}"
                        >
                      </button>
                      <template>
                        {{ media | media_tag: image_size: "2048x", toggleable: true }}
                      </template>
              
                    </product-model>
                    <button
                      class="button button--full-width product__xr-button"
                      type="button"
                      aria-label="{{ 'products.product.xr_button_label' | t }}"
                      data-shopify-xr
                      data-shopify-model3d-id="{{ media.id }}"
                      data-shopify-title="title"
                      data-shopify-xr-hidden
                      >
                      {% render 'icon-3d-model' %}
                      {{ 'products.product.xr_button' | t }}
                    </button>
                  </div>
               
                </div>
        {% else %}
              <div  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject" class="product-single__photo product-single__video product__photo-container product__photo-container-{{ unique_id }} " 
                id="ProductPhoto{{ unique_id }}"
                style="max-width: {% render 'image-width' with image: image, width: 480 %}px;"
                data-image-id="{{ image.id }}"
                data-videoid="{{ image.id }}">
                {{ media | media_tag }}
              </div>
        {% endcase %}
      {%- endfor -%}
      </div>
    </div>

{%- assign non_variant_image_count = 0 -%}
{%- for media in product.media -%}
  {%- assign is_variant_image = false -%}
  {%- for variant in product.variants -%}
    {%- if variant.image.src == media.src -%}
      {%- assign is_variant_image = true -%}
      {%- break -%}
    {%- endif -%}
  {%- endfor -%}
  
  {%- unless is_variant_image -%}
    {%- assign non_variant_image_count = non_variant_image_count | plus: 1 -%}
  {%- endunless -%}
{%- endfor -%}
      
{%- if non_variant_image_count > 1 -%}
    <div class="photos__item photos__item--thumbs {{ layout_mobile }}">
      <div class="product-single__thumbnails product-single__thumbnails-{{ unique_id }} product-single__thumbnails--static">
{%- for media in product.media -%}
  {%- assign is_variant_image = false -%}
  {%- for variant in product.variants -%}
    {%- if variant.image.src == media.src -%}
      {%- assign is_variant_image = true -%}
      {%- break -%}
    {%- endif -%}
  {%- endfor -%}
  
  {%- if is_variant_image -%}
    {%- continue -%}
  {%- endif -%}
{% assign image = media %}

        <div class="item product-single__thumbnail-item product-single__thumbnail-item-{{ unique_id }}{% if image == featured_image %} is-active {% endif %}" 
  data-image-id="{{ image.id }}">
          <a href="{{ media | image_url: width: 1200 }}"  class="product-single__thumbnail product-single__thumbnail-{{ unique_id }}"
            {% if media.media_type == 'video' %}
            data-videoid="{{ image.id }}"
            {% endif %}>
            <span class="{{ image_size }} position-relative image-wrap" style="padding-top:{% if media.media_type == 'model' %}100% {% else %} {{ 1 | divided_by: media.aspect_ratio | times: 100 }}% {% endif %}">
                {% assign img_url = image | image_url: width: 1 | replace: 'width=1', 'width={width}' %}
                <img class="lazyload {% unless image == featured_image %} lazypreload {% endunless %}"
                     src="{{ image | image_url: width: 1, height: 1 }}"
                     data-src="{{ img_url }}"
                     data-widths="[180, 240, 360]"
                     data-aspectratio="{{ image.aspect_ratio }}"
                     data-sizes="auto"
                     alt="{{ image.alt | escape }}"
                     loading="lazy"
                     width="{{ image.width }}"
                     height="{{ image.height }}">
               {% case media.media_type %}
                {%   when 'video' or 'external_video' %}
                  <span class="thumbnail__badge thumbnail__badge-video">
                    {% render 'icon-play' %}
                  </span>
                {% when 'model' %}
                  <span class="thumbnail__badge">
                  {% render 'icon-3d-model' %}
                </span>
               {% endcase %}
              </span>
          </a>
        </div>
        {%- endfor -%}
      </div>
    </div>
    <script>
      {%- liquid
        capture arrow_left  
        render 'icon-arrow-left' 
        endcapture
        capture arrow_right  
        render 'icon-arrow-right'  
        endcapture 
        capture arrow_up  
        render 'icon-arrow-up' 
        endcapture
        capture arrow_down  
        render 'icon-arrow-down' 
        endcapture
      -%}
      var sliderArrows = {
        left: {{ arrow_left | json }},
        right: {{ arrow_right | json }},
        up: {{ arrow_up | json }},
        down: {{ arrow_down | json }}
      }
    </script>
    {%- endif -%}
    
<script>
console.log('Variant switcher loading...');

(function() {
  'use strict';
  
  // Find THIS block's container using the unique section ID
  const blockContainer = document.querySelector('#shopify-section-{{ unique_id }}');
  console.log('Looking for unique container:', '#shopify-section-{{ unique_id }}');
  console.log('Block ID:', '{{ block_id }}');
  console.log('Found container:', blockContainer);
  
  if (!blockContainer) {
    console.log('Block container not found for {{ unique_id }}');
    return;
  }
  
  const variants = [
    {%- for variant in product.variants -%}
      {
        id: {{ variant.id | json }},
        image: {{ variant.image.src | json }},
        option1: {{ variant.option1 | json }},
        option2: {{ variant.option2 | json }},
        price: {{ variant.price | json }}
      }{%- unless forloop.last -%},{%- endunless -%}
    {%- endfor -%}
  ];
  
  console.log('Loaded variants for {{ unique_id }}:', variants.length);
  
  function updateVariantImage(variantId) {
    console.log('Updating for variant ID in {{ unique_id }}:', variantId);
    
    const variant = variants.find(function(v) { return v.id === variantId; });
    
    if (!variant) {
      console.log('Variant not found for ID:', variantId);
      return;
    }
    
    // Update price
    const priceElement = document.getElementById('ProductPrice-{{ section.id }}');
    if (priceElement && variant.price) {
      const formattedPrice = (variant.price / 100).toFixed(2);
      priceElement.textContent = '$' + formattedPrice;
      priceElement.setAttribute('content', formattedPrice);
      console.log('Updated price to:', formattedPrice);
    }
    
    // Update size display
    const sizeDisplay = blockContainer.querySelector('.js-swatch-display--1');
    if (sizeDisplay) {
      const sizeInput = blockContainer.querySelector('input[name="diameter-size"]:checked');
      if (sizeInput) {
        const sizeOptionIndex = sizeInput.getAttribute('data-index');
        const sizeValue = sizeOptionIndex === 'option1' ? variant.option1 : variant.option2;
        sizeDisplay.textContent = sizeValue;
        console.log('Updated size display to:', sizeValue);
      }
    }
    
    // Update images
    console.log('Variant object:', variant);
    console.log('Featured image:', variant.featured_image);
    console.log('Image:', variant.image);

    const variantImageSrc = variant.featured_image ? variant.featured_image.src : variant.image;

    if (variantImageSrc) {
      console.log('Found variant image:', variantImageSrc);
      
      const allImages = blockContainer.querySelectorAll('.product__photo-container img, .product-single__photo img, .product-photo-container img');
      console.log('Found images to update in {{ unique_id }}:', allImages.length);
      
      allImages.forEach(function(img) {
        console.log('Updating image, old src:', img.src);
        img.src = variantImageSrc;
        img.srcset = variantImageSrc;
        img.setAttribute('data-src', variantImageSrc);
        console.log('New src:', variantImageSrc);
        
        img.classList.remove('lazyload', 'lazypreload');
        img.classList.add('lazyloaded');
      });
      
      const photoswipeItems = blockContainer.querySelectorAll('[data-mfp-src], [data-zoom-src], .product__photo-wrapper');
      photoswipeItems.forEach(function(item) {
        item.setAttribute('data-mfp-src', variantImageSrc);
        item.setAttribute('data-zoom-src', variantImageSrc);
        if (item.href) item.href = variantImageSrc;
      });
      
      console.log('All images updated in {{ unique_id }}!');
    } else {
      console.log('No variant or image found for ID:', variantId);
    }
  }
  
  function updatePriceAndSize(variantId) {
    console.log('Updating price and size for variant ID in {{ unique_id }}:', variantId);
    
    const variant = variants.find(function(v) { return v.id === variantId; });
    
    if (!variant) {
      console.log('Variant not found for ID:', variantId);
      return;
    }
    
    // Update price
    const priceElement = document.getElementById('ProductPrice-{{ section.id }}');
    if (priceElement && variant.price) {
      const formattedPrice = (variant.price / 100).toFixed(2);
      priceElement.textContent = '$' + formattedPrice;
      priceElement.setAttribute('content', formattedPrice);
      console.log('Updated price to:', formattedPrice);
    }
    
    // Update size display
    const sizeDisplay = blockContainer.querySelector('.js-swatch-display--1');
    if (sizeDisplay) {
      const sizeInput = blockContainer.querySelector('input[name="diameter-size"]:checked');
      if (sizeInput) {
        const sizeOptionIndex = sizeInput.getAttribute('data-index');
        const sizeValue = sizeOptionIndex === 'option1' ? variant.option1 : variant.option2;
        sizeDisplay.textContent = sizeValue;
        console.log('Updated size display to:', sizeValue);
      }
    }
  }
  
  function getSelectedVariantByOptions() {
    const sizeInput = blockContainer.querySelector('input[name="diameter-size"]:checked, select[name="diameter-size"]');
    const colorInput = blockContainer.querySelector('input[name="color"]:checked');
  
    console.log('getSelectedVariantByOptions in {{ unique_id }}');
    console.log('Size input:', sizeInput);
    console.log('Color input:', colorInput);
  
    if (sizeInput && colorInput) {
      const size = sizeInput.value;
      const color = colorInput.value;
      console.log('Looking for variant in {{ unique_id }} with size:', size, 'color:', color);
      
      const variant = variants.find(function(v) {
        return (v.option1 === size && v.option2 === color) || 
               (v.option1 === color && v.option2 === size);
      });
      
      if (variant) {
        console.log('Found variant by options in {{ unique_id }}:', variant.id);
        return variant.id;
      }
    }
    return null;
  }
  
  function init() {
    console.log('Initializing {{ unique_id }}...');
    
    const colorInputs = blockContainer.querySelectorAll('input.single-option-selector-{{ unique_id }}[name="color"]');
    console.log('Found color inputs in {{ unique_id }}:', colorInputs.length);
    console.log('First input class:', colorInputs[0] ? colorInputs[0].className : 'none');
    console.log('First input closest section:', colorInputs[0] ? colorInputs[0].closest('[id^="shopify-section-"]').id : 'none');

    colorInputs.forEach(function(input) {
      input.addEventListener('change', function(e) {
        e.stopPropagation();
        console.log('Color changed in {{ unique_id }} to:', input.value);
        const variantId = getSelectedVariantByOptions();
        if (variantId) {
          updateVariantImage(variantId);
        }
      });
    });
    
    const sizeInputs = blockContainer.querySelectorAll('input.single-option-selector-{{ unique_id }}[name="diameter-size"], select.single-option-selector-{{ unique_id }}[name="diameter-size"]');
    console.log('Found size inputs in {{ unique_id }}:', sizeInputs.length);
    
    sizeInputs.forEach(function(input) {
      input.addEventListener('change', function(e) {
        e.stopPropagation();
        console.log('Size changed in {{ unique_id }} to:', input.value);
        const variantId = getSelectedVariantByOptions();
        if (variantId) {
          updatePriceAndSize(variantId);
        }
      });
    });
    
    const initialVariantId = getSelectedVariantByOptions();
    if (initialVariantId) {
      updatePriceAndSize(initialVariantId);
    }
  }
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>

{% if media_style == 'media-bottom' %}
  </div>
{% else %}
  </div>
{% endif %}
